apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: colours
  namespace: argocd
spec:
  goTemplate: true
  goTemplateOptions: ["missingkey=error"]
  generators:
  - list:
      elements:
      - name: red
        color: '#FF0000'
        targetPort: 8001
      - name: blue
        color: '#0000FF'
        targetPort: 8002
      - name: green
        color: '#00FF00'
        targetPort: 8003
  template:
    metadata:
      name: '{{.name}}-color'
    spec:
      project: default
      destination:
        namespace: pbak
        server: 'https://kubernetes.default.svc' # or put In-cluster
      source:
        repoURL: https://github.com/HylandPbak/pbak-ArgoCD-PoC.git
        targetRevision: HEAD
        path: "colorChart"
        helm:
          values: |
            name: "{{.name}}"
            color: "{{.color}}"
            service:
              targetPort: {{.targetPort}}


